# Windows Installation

# Windows Side

## Nvidia Driver
install Nvidia driver
https://www.nvidia.com/Download/index.aspx

## WSL installation
## In CMD
wsl --install
wsl --update

## WSL uninstallation
## In CMD 
wsl --list
wsl --unregister Ubuntu

# WSL Side

## Install Cuda inside WSL
### https://developer.nvidia.com/cuda-downloads
### Linus => x86_64 => WSL-Ubuntu => 2.0 => deb(local)
wget https://developer.download.nvidia.com/compute/cuda/repos/wsl-ubuntu/x86_64/cuda-wsl-ubuntu.pin
sudo mv cuda-wsl-ubuntu.pin /etc/apt/preferences.d/cuda-repository-pin-600
wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda-repo-wsl-ubuntu-11-8-local_11.8.0-1_amd64.deb
sudo dpkg -i cuda-repo-wsl-ubuntu-11-8-local_11.8.0-1_amd64.deb
sudo cp /var/cuda-repo-wsl-ubuntu-11-8-local/cuda-*-keyring.gpg /usr/share/keyrings/
sudo apt-get update
sudo apt-get -y install cuda
sudo apt install nvidia-cuda-toolkit

## Check if GPU is working
nvidia-smi

## Set proxy (If need)
export ALL_PROXY="http://192.168.31.202:7890"

## Enviroment installation
sudo apt-get update
sudo apt-get upgrade
sudo apt install python3 python3-pip
sudo apt-get install python3-tk
sudo apt install ffmpeg

## VENV Enviroment (If need, will be so slow)
sudo apt install python3.10-venv
cd /mnt/d/WSL/roop
python3 -m venv venv
source venv/bin/activate

# Requirements installation
pip install torch==2.0.1+cu118 torchvision==0.15.2+cu118 --extra-index-url https://download.pytorch.org/whl/cu118 --no-cache-dir
pip install -r requirements.txt

## Run
python3 "/mnt/d/WSL/roop/run.py" -s "/mnt/d/WSL/roop/workspace/source/person.jpg" -t "/mnt/d/WSL/roop/workspace/target/person.mp4" -o "/mnt/d/WSL/roop/workspace/output/person.mp4" --frame-processor face_swapper face_enhancer --keep-fps --keep-frames  --temp-frame-quality 0 --output-video-quality 0 --max-memory 24 --execution-provider cuda --execution-threads 8


# Apple Sillicon Installation


## Installation
cd /Users/xxx/Developer/Repositories/roop
python3 -m venv venv
source ./venv/bin/activate
pip install -r requirements.txt
pip uninstall onnxruntime
pip uninstall onnxruntime-silicon
# 1.13.1 & 1.14.1 will cause memory leak
pip install onnxruntime-silicon==1.13.1
# 1.15.0 will cause face_swapper problem
pip install onnxruntime-silicon==1.15.0

## Run
cd /Users/xxx/Developer/Repositories/roop
source ./venv/bin/activate
python3 run.py -s "/Users/xxx/Developer/Repositories/roop/workspace/source/person.jpg" -t "/Users/xxx/Developer/Repositories/roop/workspace/target/person.mp4" -o "/Users/xxx/Developer/Repositories/roop/workspace/output/person.mp4" --frame-processor face_swapper --keep-fps --keep-frames --skip-audio --temp-frame-quality 0 --output-video-quality 0 --execution-provider coreml --execution-threads 8

ffmpeg -i input.mov output.mp4